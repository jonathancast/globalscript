#! /usr/local/plan9/bin/rc

fn run_tests {
    for (i in $1/*) {
        if (test -d $i)
            run_tests $i
        if (~ $i *.test.ags) {
            if (! $GLOBALSCRIPT/bin/gstest $i)
                failing_suites=($failing_suites $i)
        }
    }
}

failing_suites=()

run_tests $GLOBALSCRIPT/gslib

if (! ~ $#failing_suites 0) {
    echo Errors in: >[1=2]
    for (i in $failing_suites)
        echo '	'^$i >[1=2]
    exit $#failing_suites^' failures'
}
