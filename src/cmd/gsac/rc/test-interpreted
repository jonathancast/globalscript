#! /usr/local/plan9/bin/rc -e

. $GLOBALSCRIPT/bin/test-fns

. $GLOBALSCRIPT/bin/globalscript

ok_grep_script	 '-- gsac-targets: Directory with .cgs files in it --' targets-cgs-file empty-bool-doc.gsac ibio ./gslib ./gsac-targets.ags ./test-fixtures

ok_grep_script_errors '-- gsac-deps: Completely empty .cgs file --' deps-empty-cgs 'empty.cgs:\$: No #type: prefix or #type: document pragma' ibio ./gslib ./gsac-deps.ags -l $GLOBALSCRIPT/gslib ./test-fixtures/empty.gsac
ok_grep_script_errors '-- gsac-deps: Document with no entry point --' deps-no-entry 'no-entry.cgs:\$: Un-expected EOF; expected symbol' ibio ./gslib ./gsac-deps.ags -l $GLOBALSCRIPT/gslib ./test-fixtures/no-entry.gsac

ok_diff_script '-- gsac-deps: Empty document --' deps-empty-doc ibio ./gslib ./gsac-deps.ags -l ./test-fixtures/gslib ./test-fixtures/empty-doc.gsac
ok_diff_script '-- gsac-deps: Empty list.t document --' deps-empty-list-doc ibio ./gslib ./gsac-deps.ags -l ./test-fixtures/gslib ./test-fixtures/empty-list-doc.gsac
ok_diff_script '-- gsac-deps: Empty ibio.prim.t document --' deps-empty-ibio-prim-doc ibio ./gslib ./gsac-deps.ags -l ./test-fixtures/gslib ./test-fixtures/empty-ibio-prim-doc.gsac
ok_diff_script '-- gsac-deps: Cast to an abstract type --' deps-cast-defn ibio ./gslib ./gsac-deps.ags -l ./test-fixtures/gslib ./test-fixtures/cast-defn.gsac
ok_diff_script '-- gsac-deps: Casts with expression sources --' deps-cast-source ibio ./gslib ./gsac-deps.ags -l ./test-fixtures/gslib ./test-fixtures/cast-source.cgs

ok_diff_script '-- gsac: Empty document --' gsac-empty-doc ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/empty-doc.cgs
ok_diff_script '-- gsac: Empty bool.t document --' gsac-empty-bool-doc ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/empty-bool-doc.cgs
ok_diff_script '-- gsac: Empty list.t document --' gsac-empty-list-doc ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/empty-list-doc.cgs
ok_diff_script '-- gsac: Empty either.t document --' gsac-empty-either-doc ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/empty-either-doc.cgs
ok_diff_script '-- gsac: Empty either.t 〈〉 document --' gsac-empty-either-record-doc ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/empty-either-record-doc.cgs

ok_grep_script_errors '-- gsac: Empty document w/ unknown type variable --' gsac-empty-doc-unkn-type-var './test-fixtures/empty-doc-unkn-type-var.cgs:3:1: Unknown type variable' ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/empty-doc-unkn-type-var.cgs

ok_diff_script '-- gsac: Expressions with no type signature --' gsac-cast-defn ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/cast-defn.cgs
ok_diff_script '-- gsac: Lifted lambda-terms --' gsac-lifted-lambda ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/lifted-lambda.cgs
ok_diff_script '-- gsac: Casts with expression sources --' gsac-cast-source ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/cast-source.cgs

ok_diff_script '-- gsac: Type signatures --' gsac-type-sig ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/type-sig.cgs
ok_diff_script '-- gsac: either.t type signatures --' gsac-either-type-sig ibio ./gslib ./gsac.ags -l ./test-fixtures/gslib ./test-fixtures/either-type-sig.cgs
