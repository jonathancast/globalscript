fn ok_diff {
    echo $1
    if (! $2 ./test-gslib ./test-gslib/$3 > ./test-results/$3^-actual >[2] ./test-results/$3^-errors) {
        echo $2 'failed; should have succeeded' >[1=2]
        cat ./test-results/$3^-errors >[1=2]
        cat ./test-results/$3^-actual >[1=2]
        exit 1
    }
    if (! diff ./test-results/$3^-actual ./test-results/$3^-expected) {
        echo $2 'produced incorrect output' >[1=2]
        echo '--- Actual ---' >[1=2]
        cat ./test-results/$3^-errors >[1=2]
        cat ./test-results/$3^-actual >[1=2]
        echo '--- Expected ---' >[1=2]
        cat ./test-results/$3^-expected
        exit 1
    }
    true
}

fn ok_diff_fail {
    echo $1
    if ($2 ./test-gslib ./test-gslib/$3 > ./test-results/$3^-actual >[2] ./test-results/$3^-errors) {
        echo $2 'succeeded; should have failed' >[1=2]
        cat ./test-results/$3^-errors >[1=2]
        cat ./test-results/$3^-actual >[1=2]
        exit 1
    }
    if (! diff ./test-results/$3^-actual ./test-results/$3^-expected) {
        echo $2 'produced incorrect output' >[1=2]
        echo '--- Actual ---' >[1=2]
        cat ./test-results/$3^-errors >[1=2]
        cat ./test-results/$3^-actual >[1=2]
        echo '--- Expected ---' >[1=2]
        cat ./test-results/$3^-expected
        exit 1
    }
    true
}

fn ok_grep_errors {
    echo $1
    if ($3 ./test-gslib ./test-gslib/$4 > ./test-results/$4^-actual >[2] ./test-results/$4^-errors) {
        echo $3 'succeeded; should have failed' >[1=2]
        cat ./test-results/$4^-errors >[1=2]
        cat ./test-results/$4^-actual >[1=2]
        exit 1
    }
    if (! grep -s $2 ./test-results/$4^-errors) {
        echo 'Can''t find expected error message in output anywhere' >[1=2]
        cat ./test-results/$4^-errors >[1=2]
        cat ./test-results/$4^-actual >[1=2]
        exit 1
    }
    true
}
